<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Evacuation Map – ReadyNow</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h2 onclick="window.location.href='index.html'" style="cursor:pointer;">
    ReadyNow
  </h2>
</header>

<main>
<h1>Evacuation Map</h1>

<div class="card">
  <h3>Current Weather – Quezon City</h3>
  <p id="weather">Loading...</p>
</div>

<div class="card">
  <iframe
    id="mapFrame"
    width="100%"
    height="400"
    style="border:0"
    loading="lazy">
  </iframe>
</div>

<div class="card">
  <h3>Evacuation Facilities</h3>
  <ul id="facilityList"></ul>
</div>

</main>

<script>

// =============================
// GET URL PARAMETERS
// =============================
const params = new URLSearchParams(window.location.search);
const barangay = params.get("barangay");

// =============================
// EVACUATION CENTER DATA (SAMPLE)
// Add the rest later
// =============================
const evacuationData = {

"Payatas": [
  "Multi-Purpose Hall",
  "Payatas Phase 2 Covered Court",
  "Payatas Phase 4 Covered Court",
  "Golden Shower Covered Court",
  "Plaza Dos Covered Court",
  "Bulacan St. Barangay Hall Covered Court",
  "Payatas Livelihood Building",
  "Talisay Covered Court"
],

"Bagong Silangan": [
  "Bagong Silangan Elementary School",
  "Bagong Silangan High School",
  "Bona Multipurpose Hall",
  "Brookside Evacuation Site",
  "Clemencia Evacuation Center",
  "Fil-Heights Club House"
],

"Batasan Hills": [
  "Batasan National High School",
  "San Diego Elementary School",
  "President Corazon Aquino Elementary School",
  "Area A-3 Covered Court",
  "Freedom Park Covered Court"
]

};

// =============================
// IF NO BARANGAY SELECTED
// =============================
if (!barangay) {
  document.querySelector("main").innerHTML =
    "<h2>No barangay selected.</h2><p>Please go back and choose a district and barangay.</p>";
} else {

  // =============================
  // WEATHER
  // =============================
  fetch("https://api.openweathermap.org/data/2.5/weather?q=Quezon City,PH&units=metric&appid=585f6af2cbff1e00738777e8c9af0136")
  .then(res => res.json())
  .then(data => {
    if (data.main) {
      document.getElementById("weather").innerText =
        `Temperature: ${data.main.temp}°C | Condition: ${data.weather[0].description}`;
    } else {
      document.getElementById("weather").innerText =
        "Weather data unavailable.";
    }
  })
  .catch(() => {
    document.getElementById("weather").innerText =
      "Unable to load weather data.";
  });

  // =============================
  // MAP
  // =============================
  document.getElementById("mapFrame").src =
    `https://www.google.com/maps?q=${encodeURIComponent(barangay + ", Quezon City")}&output=embed`;

  // =============================
  // DISPLAY FACILITIES (FIXED MATCHING)
  // =============================
  const cleanBarangay = barangay.trim().toLowerCase();

  const matchedKey = Object.keys(evacuationData).find(
    key => key.toLowerCase() === cleanBarangay
  );

  const list = document.getElementById("facilityList");

  if (matchedKey) {
    evacuationData[matchedKey].forEach(place => {
      const li = document.createElement("li");
      li.textContent = place;
      list.appendChild(li);
    });
  } else {
    list.innerHTML =
      "<li>No evacuation centers listed yet for this barangay.</li>";
  }

}

</script>

</body>
</html>